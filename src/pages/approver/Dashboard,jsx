import React, { useState, useEffect, useMemo } from "react";
import {
  Card,
  Row,
  Col,
  Button,
  Table,
  Tag,
  Input,
  Badge,
  Typography,
  Modal,
  message,
  Descriptions,
  Space,
  Divider,
  Select,
  DatePicker,
  Statistic,
  Timeline,
  Tabs,
  Avatar,
  Popconfirm,
  Upload,
  Spin,
  Empty,
  Tooltip,
  Progress,
  Alert
} from "antd";
import {
  SearchOutlined,
  FileTextOutlined,
  UserOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  EyeOutlined,
  ClockCircleOutlined,
  FilterOutlined,
  DownloadOutlined,
  MailOutlined,
  PhoneOutlined,
  CalendarOutlined,
  TeamOutlined,
  CheckOutlined,
  CloseOutlined,
  FilePdfOutlined,
  HistoryOutlined,
  ArrowLeftOutlined,
  ReloadOutlined,
  ExclamationCircleOutlined,
  InfoCircleOutlined,
  ArrowRightOutlined,
  SettingOutlined,
  BellOutlined,
  ProfileOutlined
} from "@ant-design/icons";
import dayjs from "dayjs";
import relativeTime from "dayjs/plugin/relativeTime";
import { useNavigate } from "react-router-dom";

dayjs.extend(relativeTime);

// Import the DeferralReviewModal component (extract from original Approver.jsx)
import DeferralReviewModal from "../../components/deferrals/DeferralReviewModal";

// Theme colors matching NCBA system
const PRIMARY_BLUE = "#164679";
const ACCENT_LIME = "#b5d334";
const SUCCESS_GREEN = "#52c41a";
const ERROR_RED = "#ff4d4f";
const WARNING_ORANGE = "#faad14";
const SECONDARY_PURPLE = "#7e6496";

const { Title, Text, Paragraph } = Typography;
const { TextArea } = Input;
const { Option } = Select;
const { TabPane } = Tabs;

// MOCK DATA (same as before)
const MOCK_APPROVER_QUEUE = [
  // ... (same MOCK_APPROVER_QUEUE data from previous Approver.jsx)
];

const Dashboard = () => {
  const navigate = useNavigate();
  const [activeTab, setActiveTab] = useState("pending");
  const [selectedDeferral, setSelectedDeferral] = useState(null);
  const [modalOpen, setModalOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState([]);
  
  // Filters
  const [searchText, setSearchText] = useState("");
  const [categoryFilter, setCategoryFilter] = useState("all");
  const [typeFilter, setTypeFilter] = useState("all");
  const [priorityFilter, setPriorityFilter] = useState("all");
  const [statusFilter, setStatusFilter] = useState("all");
  const [dateRange, setDateRange] = useState([]);

  // Load data
  useEffect(() => {
    setLoading(true);
    setTimeout(() => {
      setData(MOCK_APPROVER_QUEUE);
      setLoading(false);
    }, 300);
  }, []);

  // Filter data (same logic as before)
  const filteredData = useMemo(() => {
    // ... (same filter logic as before)
  }, [data, activeTab, searchText, categoryFilter, typeFilter, priorityFilter, statusFilter, dateRange]);

  // Statistics (same as before)
  const stats = useMemo(() => {
    // ... (same stats logic as before)
  }, [data]);

  const handleApprove = async (id, comments) => {
    // ... (same approve logic)
  };

  const handleReject = async (id, comments) => {
    // ... (same reject logic)
  };

  const columns = [
    // ... (same columns as before)
  ];

  const clearFilters = () => {
    // ... (same clear filters logic)
  };

  const getSlaPercentage = () => {
    // ... (same SLA logic)
  };

  return (
    <div>
      {/* Statistics Cards */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col xs={24} sm={12} md={8} lg={4}>
          <Card 
            size="small" 
            style={{ 
              borderTop: `4px solid ${WARNING_ORANGE}`,
              boxShadow: "0 2px 8px rgba(0,0,0,0.1)"
            }}
          >
            <Statistic
              title="Pending Review"
              value={stats.pending}
              valueStyle={{ color: WARNING_ORANGE, fontSize: 28 }}
              prefix={<ClockCircleOutlined />}
              suffix={
                <Badge 
                  count={stats.highPriority} 
                  style={{ 
                    backgroundColor: ERROR_RED,
                    marginLeft: 8
                  }}
                />
              }
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} md={8} lg={4}>
          <Card 
            size="small" 
            style={{ 
              borderTop: `4px solid ${SUCCESS_GREEN}`,
              boxShadow: "0 2px 8px rgba(0,0,0,0.1)"
            }}
          >
            <Statistic
              title="Approved"
              value={stats.approved}
              valueStyle={{ color: SUCCESS_GREEN, fontSize: 28 }}
              prefix={<CheckCircleOutlined />}
            />
          </Card>
        </Col>
        {/* ... More stat cards ... */}
      </Row>

      {/* Main Content */}
      <Card
        style={{
          borderRadius: 12,
          boxShadow: "0 4px 20px rgba(22, 70, 121, 0.1)"
        }}
        bodyStyle={{ padding: 24 }}
      >
        {/* Tabs and Filters */}
        {/* ... (same tabs and filters as before) */}

        {/* Table */}
        {/* ... (same table as before) */}

        {/* Review Modal */}
        {selectedDeferral && (
          <DeferralReviewModal
            deferral={selectedDeferral}
            open={modalOpen}
            onClose={() => {
              setModalOpen(false);
              setSelectedDeferral(null);
            }}
            onApprove={handleApprove}
            onReject={handleReject}
          />
        )}
      </Card>
    </div>
  );
};

export default Dashboard;